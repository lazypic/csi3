{{define "review" }}
{{template "headBootstrap" .}}
<body>
    <input type="hidden" id="current-review-id" value="{{.CurrentReview.ID.Hex}}">
    <div id="floatingmenu">
        {{template "navbar" .}}
    </div>
    {{template "modal" .}}
    <div id="blinkspace" style="height:60px"></div><!--기본 100px 여유를 두고 navbar와의 간격을 조정한다.-->
    
    <div class="row mt-3 ml-3 mr-3">
        <div class="col-2 p-0 border-darkmode overflow-auto text-darkmode" style="height: 70vh;">
            <form action="/review-submit" method="POST">
                <div class="w-100">
                    <div class="input-group p-1">
                        <input type="text" name="SearchReview" class="input-group-prepend form-control form-control-sm" placeholder="검색어" value="{{.Searchword}}">
                        <div class="input-group-btn input-group-append">
                            <button class="btn btn-sm btn-darkmode" id="button">
                                Search
                            </button>
                        </div>
                    </div>
                </div>
            </form>

            <div class="overflow-auto" style="height: 65vh; overflow-y: scroll; scrollbar-color: #6d6d6d #2d2d2d;">
                {{range .Reviews}}
                    <div class="p-2 m-1 {{if eq .ID.Hex $.CurrentReview.ID.Hex}}selectreviewitem border border-warning{{else}}reviewitem{{end}} finger" name="reviewitem" id="{{.ID.Hex}}"  onclick="window.location.replace('/review?searchword={{$.Searchword}}&id={{.ID.Hex}}')">
                        <span class="text-muted">{{.Project}}</span>
                        <a href="dilink://{{.Path}}" class="text-darkmode">{{.Name}}</a>
                        <span class="ml-1 badge badge-secondary">{{.Task}}</span>
                        {{if eq .Status "comment" }}
                            <span id="reviewstatus-{{.ID.Hex}}" class="ml-1 badge badge-warning">{{.Status}}</span>
                        {{else if eq .Status "approve" }}
                            <span id="reviewstatus-{{.ID.Hex}}" class="ml-1 badge badge-success">{{.Status}}</span>
                        {{else}}
                            {{if eq .ProcessStatus "wait" "processing" }}
                                <span id="reviewstatus-{{.ID.Hex}}" class="ml-1 badge badge-danger">{{.ProcessStatus}}</span>
                            {{else}}
                                <span id="reviewstatus-{{.ID.Hex}}" class="ml-1 badge badge-secondary">{{.Status}}</span>
                            {{end}}
                        {{end}}
                    </div>
                {{end}}
            </div>
        </div>
        <div class="col-8 border-darkmode bg-black p-0" id="playerbox" style="height: 70vh; position: relative;">
            <canvas class="p-0" id="drawcanvas" style="position: absolute; left: 0; top: 0; z-index: 2;"></canvas>
            <canvas class="p-0" id="screenshot" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
            <canvas class="p-0" id="player" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
        </div>
        <div class="col-2 p-0 border-darkmode overflow-auto text-darkmode" style="height: 70vh;">
            <div style="height: 80%; overflow-y: auto; overflow-x: hidden;" id="review-comments">
                {{range ReverseCommentSlice .CurrentReview.Comments}}
                    <div id="reviewcomment-{{$.CurrentReview.ID.Hex}}-{{.Date}}" class="p-1">
                    <span class="text-badge">{{.Date}} / <a href="/user?id={{.Author}}" class="text-darkmode">{{.Author}}</a></span>
                    <span class="edit" data-toggle="modal" data-target="#modal-editreviewcomment" onclick="setEditReviewCommentModal('{{$.CurrentReview.ID.Hex}}', '{{.Date}}', '{{.Text}}', '{{.MediaTitle}}', '{{.Media}}')">≡</span>
                    <span class="remove" data-toggle="modal" data-target="#modal-rmreviewcomment" onclick="setRmReviewCommentModal('{{$.CurrentReview.ID.Hex}}', '{{.Date}}')">×</span>
                    <br><small class="text-white text-autowarp">{{.Text}}</small>
                    <hr class="my-1 p-0 m-0 divider"></hr></div>
                {{end}}
            </div>
            <div style="height: 20%">
                <textarea class="form-control no-resize" id="review-comment" rows="3" placeholder="리뷰내용을 작성해주세요."></textarea>
                <div class="pt-1 row">
                    <div class="col">
                        <span class="btn btn-sm btn-outline-warning w-100" onclick="clickCommentButton()">comment</span>
                    </div>
                    <div class="col">
                        <span class="btn btn-sm btn-outline-success w-100" onclick="setReviewStatus('approve')">approve</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row ml-3 mr-3">
        <div class="col-12 border-darkmode text-center text-darkmode no-selection">
            <span class="player-trash" id="player-trash" onclick="removeDrawing()"></span>
            <span class="player-pen" id="player-pen"></span>
            <span class="player-text" id="player-text"></span>
            <span class="player-screenshot mr-5" id="player-screenshot" onclick="screenshot('{{.CurrentReview.Project}}_{{.CurrentReview.Name}}_{{.CurrentReview.Task}}')"></span>

            <span class="player-start" id="player-start"></span>
            <span class="player-left" id="player-left"></span>
            <span class="player-pause" id="player-pause"></span>
            <span class="player-play" id="player-play"></span>
            <span class="player-right" id="player-right"></span>
            <span class="player-end mr-5" id="player-end"></span>
            <!--<span class="player-expand" id="player-expand"></span>-->
            
            <span class="player-mute" id="player-mute"></span>
            <input type="range" id="seek-bar" value="0">
            <input type="range" id="volume-bar" min="0" max="1" step="0.1" value="1">
        </div>
    </div>
    <div class="row ml-3 mr-3">
        <div class="col-12 border-darkmode text-darkmode p-0 m-0" style="white-space: nowrap; height: 10vh; overflow-x: scroll; overflow-y: hidden; scrollbar-color: #6d6d6d #2d2d2d; scrollbar-color: dark;" id="reviewgroup">
            {{range .ReviewGroup}}
                <video src="/reviewdata?id={{.ID.Hex}}" class="p-0 m-0 mr-1 finger border{{if eq .ID.Hex $.CurrentReview.ID.Hex}} border-warning{{else}} border-secondary{{end}}" style="height:98%;" onclick="window.location.replace('/review?searchword={{$.Searchword}}&id={{.ID.Hex}}')"></video>
            {{end}}
        </div>
    </div>
    {{template "footerBootstrap"}}
</body>
<script src="/assets/js/jquery-3.1.1.min.js"></script>
<script src="/assets/bootstrap-4/js/bootstrap.min.js"></script>
<script src="/assets/js/input.js"></script>
<script src="/assets/js/csi_v02.js"></script>
<script type="text/javascript">
    selectReviewItem('{{.CurrentReview.ID.Hex}}', '{{.CurrentReview.Fps}}')
</script>
</html>
{{end}}
